---
title: "Untitled"
output: html_document
---

```{r}
library(tidyverse)
library(brms)

results <- read_rds("data-simulated/1_results.rds")

data <- 
    results %>% 
    select(starts_with("item")) %>% 
    mutate(person = as.factor(row_number())) %>% 
    gather(item, correct, -person) %>% 
    mutate(
        item = item %>% parse_number() %>% as.factor(),
        correct = as.factor(correct)
    )

mod <- mirt::mirt(results %>% select(starts_with("item")), 1, "2PL")
mirt::coef(mod)

formula_2pl <- 
    bf(
        correct ~ exp(ItemDiscLog) * PersonAbility + ItemEasy,
        PersonAbility ~ 1 + (1 | person),
        ItemDiscLog ~ 0 + item,
        ItemEasy ~ 0 + item,
        nl = TRUE
    )

prior_2pl <- 
    # prior("normal(0, 0)", class = "b", nlpar = "PersonAbility") +
    # prior("normal(1, 0)", class = "sd", nlpar = "PersonAbility") +
    prior("normal(0, 1)", class = "b", nlpar = "ItemEasy") +
    prior("normal(0, 1)", class = "b", nlpar = "ItemDiscLog")

fit_2pl <- 
    brm(
        data = data,
        formula = formula_2pl,
        family = brmsfamily("bernoulli", "logit"),
        prior = prior_2pl,
        inits = 0,
        chains = 2,
        iter = 400,
        file = "data-models/fit_2pl_2",
    )
    

?brm
```
