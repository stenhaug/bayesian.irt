---
title: "Untitled"
output: html_document
---

```{r}
library(tidyverse)
library(brms)

lme4::VerbAgg %>% as_tibble()

results <- read_rds("data-simulated/1_results.rds")

data <- 
    results %>% 
    select(starts_with("item")) %>% 
    mutate(person = as.factor(row_number())) %>% 
    gather(item, correct, -person) %>% 
    mutate(
        item = item %>% parse_number() %>% as.factor(),
        correct = as.factor(correct)
    )

formula_2pl <- 
    bf(
        correct ~ PersonVsItem * exp(AlphaLog),
        PersonVsItem ~ 0 + item + (1 | person),
        AlphaLog ~ 0 + item,
        nl = TRUE
    )

prior_2pl <- 
    prior("normal(0, 5)", class = "b", nlpar = "PersonVsItem") +
    prior("normal(0, 5)", class = "sd", nlpar = "PersonVsItem", group = "person") +
    prior("normal(0, 1)", class = "b", nlpar = "AlphaLog")

fit_2pl <- 
    brm(
        data = data,
        formula = formula_2pl,
        family = brmsfamily("bernoulli", "logit"),
        prior = prior_2pl,
        inits = 0,
        file = "data-models/fit_2pl"
    )
    
```
